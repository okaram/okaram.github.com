
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Orlando's Blog</title>
  <meta name="author" content="Orlando Karam">

  
  <meta name="description" content="Lately I&#8217;ve been trying to learn javascript, and found knockoutjs, a declarative MVVM library; basically, it allows me to define a model, and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://1qaz2wsx@github.com.github.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Orlando's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Orlando's Blog</a></h1>
  
    <h2>Learning and teaching about programming.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:1qaz2wsx@github.com.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/28/a-lightsout-game-with-knockoutjs/">A LightsOut Game With Knockoutjs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-28T12:29:00-04:00" pubdate data-updated="true">May 28<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lately I&#8217;ve been trying to learn javascript, and found <a href="http://knockoutjs.com">knockoutjs</a>, a declarative MVVM library; basically, it allows me to define a model, and dynamically changes my html as my model changes.</p>

<p>One kind of application this makes easy is puzzle games, in which you have a rectangular matrix as a model for your board. One such game is <a href="http://en.wikipedia.org/wiki/Lights_Out_(game)">Lights Out</a>, in which you have a matrix of lights and you try to turn them all off. You may want to <a href="/downloads/code/knockLights/lightsOut.html">check it out</a> first, and then continue with the tutorial.</p>

<p>In knockout applications, you need to build your model (well, they call them ViewModels), which are normal javascript objects, but they contain <a href="http://knockoutjs.com/documentation/observables.html">observables</a>; you&#8217;d later bind this model to your html, and changing the value of your observable will be automatically reflected on the model.</p>

<h1>The model (javascript)</h1>

<p>Our model will be simple; our object contains one data field, called board, which is a matrix of observables (that is, an array of arrays of observables). Our constructor takes one matrix of numbers, and creates a matrix of observables from it. We also use the trick of saving the value of this into another variable, called self. Lines 14-20 below create this board.</p>

<p>Notice that observables look almost like normal variables, but they are actually functions; if you want to get the value, you need to evaluate the function, and if you want to change the value, you evaluate it with the new value as a parameter, so if you have an observable called a, using simply a gives you a function, using a() gives you its value and using a(3) would set the value inside a to 3 (roughly equivalent to a=3 :).</p>

<p>We also have a few other &#8216;methods&#8217; in our model:</p>

<ul>
<li>flipSquare, which gets passed the row and column of a square and, if it&#8217;s a valid position, flips it (from 0 to 1 or from 1 to 0);</li>
<li>allSet, which returns true if you&#8217;ve solved the puzzle (have all 0s on the board, turned off all the lights), false otherwise</li>
<li>btnClicker, which will be called whenever somebody clicks in a cell, and it just flips the 5 corresponding cells (the one clicked, above, below, left, right; notice that flipSquare already checks that positions are valid, so we do not need to check here), and then checks if you&#8217;ve solved the puzzle.</li>
</ul>


<p>Below is the javascript file for the model</p>

<figure class='code'><figcaption><span> (loModel.js)</span> <a href='/downloads/code/knockLights/loModel.js'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">board1</span><span class="o">=</span><span class="p">[</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
</span><span class='line'><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Overall viewmodel for this screen, along with initial state</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">LightsOutViewModel</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="o">=</span><span class="p">[];</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">row</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">row</span><span class="o">&lt;</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">oa</span><span class="o">=</span><span class="p">[]</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">col</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">col</span><span class="o">&lt;</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span> <span class="nx">col</span><span class="p">)</span>
</span><span class='line'>          <span class="nx">oa</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">]))</span>
</span><span class='line'>      <span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">oa</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nx">self</span><span class="p">.</span><span class="nx">flipSquare</span> <span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">col</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">row</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">row</span><span class="o">&lt;</span><span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">col</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">col</span><span class="o">&lt;</span><span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span>
</span><span class='line'>          <span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">]</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">]());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nx">self</span><span class="p">.</span><span class="nx">allSet</span><span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">row</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">row</span><span class="o">&lt;</span><span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">row</span><span class="p">)</span>
</span><span class='line'>          <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">col</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">col</span><span class="o">&lt;</span><span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span> <span class="nx">col</span><span class="p">)</span>
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">board</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">]()</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>                  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">self</span><span class="p">.</span><span class="nx">btnClicker</span>  <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">self</span><span class="p">.</span><span class="nx">flipSquare</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">col</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">self</span><span class="p">.</span><span class="nx">flipSquare</span><span class="p">(</span><span class="nx">row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nx">col</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">self</span><span class="p">.</span><span class="nx">flipSquare</span><span class="p">(</span><span class="nx">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">col</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">self</span><span class="p">.</span><span class="nx">flipSquare</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">col</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">self</span><span class="p">.</span><span class="nx">flipSquare</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">col</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">allSet</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;great job !&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h1>The css</h1>

<p>To make it simple, the board will be a table, with empty cells, and we&#8217;ll change the background color of the cell to mark whether the light is on or off on that cell. So, our css just defines width and height for table cells (so they appear, even when empty), and then two css classes, called a0 and a1, with different background colors (blue for a0, green for a1)</p>

<figure class='code'><figcaption><span> (lo.css)</span> <a href='/downloads/code/knockLights/lo.css'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">td</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.a1</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#00FF00</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.a0</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#0000FF</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h1>the html</h1>

<p>The html will be relatively simple; it includes jquery (for document.ready) and knockout, and our model (loModel.js), and links to our css; its body defines a function to call when ready, which creates an instance of our model (passing it some sample data), and then calls ko.applyBindings, which does all the magic; our html will have data-bind attributes, that knockout processes.</p>

<p>The html part just defines a table, with no header and a tbody. The tbody has a data-bind of <a href="http://knockoutjs.com/documentation/foreach-binding.html">foreach</a>: board, which means look inside the model, find a field called board (which should be an array), and then generate the html inside, for each one of the elements.</p>

<p>Inside a foreach binding, you can use $data to refer to the actual element, $index to refer to its index, and, inside a nested foreach, $parentContext to refer to the context outside.</p>

<p>So, inside our tbody, we put <tr> tags, with data-bind set to foreach: $data, which means our $data (the element inside the previous foreach) should be an array, and we&#8217;ll generate the html inside (the <td>) once for each element.</p>

<p>Our <td> tags have the magic; we use two different data-binds:</p>

<ul>
<li>css which applies one or more css classes, depending on the condition (in this case, either a0 or a1, depending on the value stored in the board; notice our context is the nested foreach, so $data is the actual element on the board (0 or 1).</li>
<li>click which specifies a function to call on a click; here we call the model&#8217;s buttonClicker function with row and column to generate the appropriate function; since we&#8217;re inside the nested foreach, $parentContext.$index() represents the row, and $index() the column.</li>
</ul>


<p>And that&#8217;s it ! isn&#8217;t knockout cool ?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/09/test/">Test</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-09T19:30:00-04:00" pubdate data-updated="true">May 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a sample post. I hope it works.</p>

<p>But I can&#8217;t remember markdown&#8217;s syntax :)</p>

<figure class='code'><figcaption><span> (hello.cpp)</span> <a href='/downloads/code/hello.cpp'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello world&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/05/28/a-lightsout-game-with-knockoutjs/">A LightsOut game with knockoutjs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/09/test/">test</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Orlando Karam -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
